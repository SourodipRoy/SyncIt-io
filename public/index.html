<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SyncIt â€” Real-time Music Room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg-glow"></div>
  <div class="bg-grid"></div>

  <header class="site-header">
    <div class="container header-inner">
      <div class="logo">
        <img class="logo-mark" src="images/logo.png" alt="SyncIt logo" width="22" height="22" />
        <span>SyncIt</span>
      </div>
      <nav class="nav">
        <a href="#features">Features</a>
        <a href="#how">How it works</a>
        <a href="/app" class="pill">Open App</a>
      </nav>
    </div>
  </header>

  <main class="hero">
    <div class="container hero-inner">
      <h1>Turn your devices into <span class="accent">one perfectly-synced sound system</span>.</h1>
      <p class="tagline">
        Create a room, share a 6-digit code, and transform phones, tablets, and computers into a synchronized speaker network with sub-100ms precision.
      </p>
      <div class="cta-row">
        <button class="btn btn-accent" id="ctaCreate">Create Room</button>
        <button class="btn btn-ghost" id="ctaJoin">Join Room</button>
      </div>

      <div class="mini-note">Developer: Sourodip Roy AKA Equilibrium.dev ðŸŽ€</div>

      <!-- Features -->
      <section id="features" class="features">
        <div class="feature">
          <div class="feat-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <path d="M3 12h4l2-6 4 12 2-6h4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h3>Ultra-tight Sync</h3>
          <p>Periodic time beacons + drift compensation keep everyone together (&lt;100&nbsp;ms).</p>
        </div>
        <div class="feature">
          <div class="feat-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <path d="M12 3l7 3v6c0 5-3.5 8.5-7 9-3.5-.5-7-4-7-9V6l7-3z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
          </div>
          <h3>Secure Rooms</h3>
          <p>Share a 6-digit code and optional PIN. Codes expire when rooms end.</p>
        </div>
        <div class="feature">
          <div class="feat-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <path d="M4 6h16M4 12h16M4 18h16M9 6v6M15 12v6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          <h3>Host Control</h3>
          <p>Play, pause, seek, volume, loop, shuffle, reorder, kick, and transfer host instantly.</p>
        </div>
        <div class="feature">
          <div class="feat-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <path d="M7 14a4 4 0 1 1 10 0M3 20a7 7 0 1 1 18 0" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          <h3>50+ Listeners</h3>
          <p>Designed for scale via SFU or data channels with a single shared media source.</p>
        </div>
        <div class="feature">
          <div class="feat-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <path d="M21 15a4 4 0 0 1-4 4H8l-5 3V6a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
          </div>
          <h3>Built-in Chat</h3>
          <p>Stay in sync and in touch with a simple, lightweight chat for the whole room.</p>
        </div>
        <div class="feature">
          <div class="feat-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <path d="M4 9v6h4l5 4V5L8 9H4zM16 9l4 6M20 9l-4 6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          <h3>Local Mute</h3>
          <p>Participants can mute locally without affecting the room stream.</p>
        </div>
      </section>
    </div>
  </main>

  <!-- Modal -->
  <div class="modal" id="roomModal" aria-hidden="true">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <h3 id="modalTitle">Start Listening Together</h3>
        <button class="icon-btn" title="Close" aria-label="Close" data-close>âœ•</button>
      </div>

      <!-- STEP 1: Create/Join form -->
      <div class="stack gap" id="stepCreate">
        <input id="username--modal" placeholder="Username" autocomplete="nickname" />
        <div id="roomIdRow">
          <input id="roomId--modal" placeholder="Enter 6-digit Room ID" inputmode="numeric" maxlength="6" />
        </div>
        <input id="pin--modal" placeholder="Optional PIN" />
        <div class="row gap">
          <button class="btn btn-accent" id="modalContinue">Continue</button>
        </div>
        <small class="muted" id="modalHint"></small>
      </div>

      <!-- STEP 2: Review details for Create -->
      <div class="stack gap hidden" id="stepReview" aria-live="polite">
        <div class="stack gap">
          <label>Room ID</label>
          <div class="row gap">
            <input id="reviewRoomId" readonly />
            <button class="icon-btn" id="copyCode" title="Copy Room ID" aria-label="Copy Room ID">
              <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                <path d="M16 3H6a2 2 0 0 0-2 2v10h2V5h10V3zm-1 4H9a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" fill="currentColor"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="stack gap" id="reviewPinRow">
          <label>PIN</label>
          <div class="row gap">
            <input id="reviewPin" readonly />
            <button class="icon-btn" id="copyPin" title="Copy PIN" aria-label="Copy PIN">
              <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                <path d="M16 3H6a2 2 0 0 0-2 2v10h2V5h10V3zm-1 4H9a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" fill="currentColor"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="row gap" style="justify-content:flex-end">
          <button class="btn btn-ghost" id="reviewBack">Back</button>
          <button class="btn btn-accent" id="reviewEnter">Enter Room</button>
        </div>
        <small class="muted">Share this Room ID (and PIN if set) with others, then enter the room.</small>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-inner">
      <span class="muted">Â© <span id="year"></span> SyncIt</span>
      <span class="muted">Made for perfectly-synced rooms.</span>
    </div>
  </footer>

  <script>
    const qs = (q) => document.querySelector(q);
    const modal = qs('#roomModal');
    const stepCreate = qs('#stepCreate');
    const stepReview = qs('#stepReview');
    const reviewRoomId = qs('#reviewRoomId');
    const reviewPin = qs('#reviewPin');
    const reviewPinRow = qs('#reviewPinRow');

    const openModal = () => { modal.setAttribute('aria-hidden','false'); modal.classList.add('open'); };
    const closeModal = () => { modal.setAttribute('aria-hidden','true'); modal.classList.remove('open'); resetToCreateStep(); };

    let mode = "create"; // or "join"
    let generatedCode = ""; // holds 6-digit code for create flow

    function showStep(which){
      if (which === "create") { stepCreate.classList.remove('hidden'); stepReview.classList.add('hidden'); }
      else { stepCreate.classList.add('hidden'); stepReview.classList.remove('hidden'); }
    }
    function resetToCreateStep(){
      showStep("create");
      const title = qs('#modalTitle');
      const hint = qs('#modalHint');
      if (mode === "create") {
        title.textContent = "Create a Room";
        hint.textContent = "Weâ€™ll generate a 6-digit Room ID and take you to the app.";
      } else {
        title.textContent = "Join an Existing Room";
        hint.textContent = "Enter the room code and continue to join.";
      }
    }

    function setMode(m){
      mode = m;
      const title = qs('#modalTitle');
      const roomRow = qs('#roomIdRow');
      const hint = qs('#modalHint');
      const roomInput = qs('#roomId--modal');
      qs('#username--modal').value = "";
      qs('#pin--modal').value = "";
      generatedCode = "";
      showStep("create");
      if (mode === "create") {
        title.textContent = "Create a Room";
        roomRow.style.display = "none";
        roomInput.value = "";
        hint.textContent = "Weâ€™ll generate a 6-digit Room ID and then show it so you can copy/share.";
      } else {
        title.textContent = "Join an Existing Room";
        roomRow.style.display = "";
        roomInput.placeholder = "Enter 6-digit Room ID";
        hint.textContent = "Enter the room code and continue to join.";
      }
    }

    qs('#ctaCreate')?.addEventListener('click', () => { setMode('create'); openModal(); });
    qs('#ctaJoin')?.addEventListener('click', () => { setMode('join'); openModal(); });

    modal?.addEventListener('click', (e) => {
      if (e.target.dataset.close !== undefined || e.target.classList.contains('modal')) closeModal();
    });
    modal?.querySelectorAll('[data-close]')?.forEach(btn => btn.addEventListener('click', closeModal));
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    function go(){
      const user = encodeURIComponent((qs('#username--modal').value || "").trim());
      const pinRaw  = (qs('#pin--modal').value || "").trim();
      const pin  = encodeURIComponent(pinRaw);
      if (!user) { alert("Username is required."); return; }

      if (mode === "create") {
        // Step 2: show review with generated code & optional pin
        generatedCode = String(Math.floor(100000 + Math.random() * 900000));
        reviewRoomId.value = generatedCode;
        if (pinRaw) {
          reviewPin.value = pinRaw;
          reviewPinRow.style.display = "";
        } else {
          reviewPin.value = "";
          reviewPinRow.style.display = "none";
        }
        qs('#modalTitle').textContent = "Share Room Details";
        showStep("review");
        return;
      } else {
        // Join flow as before
        const code = (qs('#roomId--modal').value || "").trim();
        if (!/^\d{6}$/.test(code)) { alert("Please enter a valid 6-digit Room ID."); return; }
        const url = `/app?role=join&code=${encodeURIComponent(code)}${pin ? `&pin=${pin}`:''}${user ? `&user=${user}`:''}`;
        location.href = url;
      }
    }
    qs('#modalContinue')?.addEventListener('click', go);

    // Review actions
    qs('#reviewBack')?.addEventListener('click', () => { resetToCreateStep(); });
    qs('#reviewEnter')?.addEventListener('click', () => {
      const user = encodeURIComponent((qs('#username--modal').value || "").trim());
      const pin  = encodeURIComponent((qs('#pin--modal').value || "").trim());
      if (!generatedCode) return;
      const url = `/app?role=create&code=${encodeURIComponent(generatedCode)}${pin ? `&pin=${pin}`:''}${user ? `&user=${user}`:''}`;
      location.href = url;
    });
    qs('#copyCode')?.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(reviewRoomId.value.trim()); } catch {}
    });
    qs('#copyPin')?.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(reviewPin.value.trim()); } catch {}
    });

    document.getElementById('year').textContent = new Date().getFullYear();
    setMode('create');
  </script>
</body>
</html>